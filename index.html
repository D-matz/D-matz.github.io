<!DOCTYPE html> 
<html lang="en"> 
  
<head> 
    <meta charset="UTF-8" /> 
    <meta name="viewport" content=
        "width=device-width,initial-scale=1.0" /> 
    <script src="https://d3js.org/d3.v4.js"></script> 
    <script src=
"https://d3js.org/d3-geo-projection.v2.min.js">
    </script>
	<style>
	body, html {
		margin: 0;
		padding: 0;
		background-color: #ffffff;
	}
	
	#nav a {
		font-size: 30px;
	  text-decoration: none;
	}

	#nav *:hover {
	  box-shadow: 0 0 8px red;
	  transition: all 0.2s ease-in-out;
	}
	
	:root {
  --bg-color-light: #f0f0e8;
  --bg-color-dark: #1c2135;
  --border-color-light: #1c2135;
  --border-color-dark: #f0f0e8;
  --sun-color: #fabc1c;
  --moon-color: #fffdf2;
  --day-bg-color: #0dbdf6;
  --night-bg-color: #272a30;
  --cloud-color: #fffdf2;
  --star-color: #fffdf2;
--ocean-color-light: #A6D7F0;
--ocean-color-dark: #023E58;
--country-one: #EF476F;
--country-two: #06D6A0;
--country-three: #FFD166;
--country-four: #8338EC;



}

body {
  background-color: var(--bg-color-light);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
  transition: background-color 0.8s ease;
}

.theme-switcher-grid {
  display: grid;
  grid-template-columns: repeat(54, 1px);
  grid-template-rows: repeat(24, 1px);
  gap: 0;
  position: relative;
  background-color: var(--day-bg-color);
  border-radius: 49px;
  border: 1px solid var(--border-color-light);
  cursor: pointer;
  transition: background-color 0.8s ease, border-color 0.8s ease;
  appearance: none;
  padding: 0;
}

.theme-switcher-grid.night-theme {
  background-color: var(--night-bg-color);
  border-color: var(--border-color-dark);
}

.sun {
  background-color: var(--sun-color);
  grid-column: 3 / 23;
  grid-row: 3 / 23;
  border-radius: 50%;
  transition: grid-column 0.8s ease, background-color 0.8s ease;
  height: 20px;
}

.theme-switcher-grid.night-theme .sun {
  grid-column: 33 / 53;
  background-color: var(--moon-color);
}

.moon-overlay {
  position: absolute;
  border-radius: 50%;
  transition: left 0.8s ease, background-color 0.8s ease;
  z-index: 1;
  background-color: var(--day-bg-color);
}

.theme-switcher-grid.night-theme .moon-overlay {
  display: block;
  left: calc(28 / 54 * 100%);
  top: calc(4 / 29 * 100%);
  width: 18px;
  height: 18px;
  background-color: var(--night-bg-color);
}

.cloud-ball {
  background-color: var(--cloud-color);
  border-radius: 50%;
  width: 9px;
  height: 9px;
  position: absolute;
  transition: all 0.8s ease;
  z-index: 2;
}

#ball1 {
  top: calc((8 / 24) * 100%);
  left: calc((12 / 54) * 100%);
}

#ball2 {
  top: calc((8 / 24) * 100%);
  left: calc((17 / 54) * 100%);
}

#ball3 {
  top: calc((8 / 24) * 100%);
  left: calc((22 / 54) * 100%);
}

#ball4 {
  top: calc((6 / 24) * 100%);
  left: calc((17 / 54) * 100%);
}

.theme-switcher-grid.night-theme #ball1 {
  top: calc((16 / 24) * 100%);
  left: calc((16 / 54) * 100%);
  width: 2px;
  height: 2px;
}

.theme-switcher-grid.night-theme #ball2 {
  top: calc((3 / 24) * 100%);
  left: calc((22 / 54) * 100%);
  width: 2px;
  height: 2px;
}

.theme-switcher-grid.night-theme #ball3 {
  top: calc((10 / 24) * 100%);
  left: calc((29 / 54) * 100%);
  width: 2px;
  height: 2px;
}

.theme-switcher-grid.night-theme #ball4 {
  top: calc((5 / 24) * 100%);
  left: calc((34 / 54) * 100%);
  width: 2px;
  height: 2px;
}

.star {
  background-color: var(--star-color);
  width: 1px;
  height: 1px;
  position: absolute;
  opacity: 0;
  transition: opacity 0.8s ease;
}

#star1 {
  top: calc((7 / 24) * 100%);
  left: calc((10 / 54) * 100%);
  border-radius: 50%;
}

#star2 {
  top: calc((9 / 24) * 100%);
  left: calc((16 / 54) * 100%);
  border-radius: 50%;
}

#star3 {
  top: calc((13 / 24) * 100%);
  left: calc((23 / 54) * 100%);
  border-radius: 50%;
}

#star4 {
  top: calc((18 / 24) * 100%);
  left: calc((29 / 54) * 100%);
  border-radius: 50%;
}

.theme-switcher-grid.night-theme #star1,
.theme-switcher-grid.night-theme #star2,
.theme-switcher-grid.night-theme #star3,
.theme-switcher-grid.night-theme #star4 {
  opacity: 1;
}
</style>
</head>
<body> 
<div style="display: flex; flex-direction: column; min-height: 100vh;">
  <div id="nav" style="display: flex; align-items: center; padding: 10px;">
    <a title="globe" href="#">üåé</a>
    <a title="map" href="#">üó∫Ô∏è</a>
    <a title="list" href="#">üìÑ</a>
    <button
      style="margin-left: auto; height: 25px;"
      class="theme-switcher-grid"
      id="theme-switcher-grid"
      aria-label="Switch theme"
    >
      <div class="sun" id="sun" aria-hidden="true"></div>
      <div class="moon-overlay" id="moon-overlay" aria-hidden="true"></div>
      <div class="cloud-ball cloud-ball-left" id="ball1" aria-hidden="true"></div>
      <div class="cloud-ball cloud-ball-middle" id="ball2" aria-hidden="true"></div>
      <div class="cloud-ball cloud-ball-right" id="ball3" aria-hidden="true"></div>
      <div class="cloud-ball cloud-ball-top" id="ball4" aria-hidden="true"></div>
      <div class="star" id="star1" aria-hidden="true"></div>
      <div class="star" id="star2" aria-hidden="true"></div>
      <div class="star" id="star3" aria-hidden="true"></div>
      <div class="star" id="star4" aria-hidden="true"></div>
    </button>
  </div>

  <div style="flex-grow: 1; display: flex; justify-content: center; align-items: center;">
    <svg style="width: min(90vh, 90vw); height: min(90vh, 90vw);">
    </svg>
  </div>
</div>


  
    <script> 
		const size = Math.min(window.innerHeight * 0.9, window.innerWidth * 0.9);
		var svg = d3.select("svg")
			.attr("width", size)
			.attr("height", size);
		const width = size;
		const height = size;
        const config = {
            speed: 0.010,
            verticalTilted: -10,
            horizontalTilted: 0
        }
		// The orthographic Earth projection 
		// Center(0,0) and no rotation 
		var projection = d3.geoOrthographic()
			.center([0, 0]) 
			.scale(size * 0.5)
			.clipAngle(90 )
			.translate([width / 2, height / 2]) 
			.rotate([0,0])

		const path = d3.geoPath().projection(projection);

		// Add ocean background
		const ocean = svg.append("circle")
			.attr("cx", width / 2)
			.attr("cy", height / 2)
			.attr("r", size * 0.5)
			.attr("fill", "var(--ocean-color-light)")
			.attr("style", "transition: fill 0.8s ease; cursor: grab;")

		// Add drag behavior
		const drag = d3.drag()
			.on("start", function() {
				d3.select(this).style("cursor", "grabbing");
				svg.selectAll("path").style("pointer-events", "none");
				hideTooltip();
			})
			.on("drag", function() {
				const rotate = projection.rotate();
				const k = 75 / projection.scale();
				const yaw = rotate[0] + d3.event.dx * k * Math.cos(rotate[1] * Math.PI / 180);
				const pitch = rotate[1] - d3.event.dy * k;
				projection.rotate([yaw, pitch]);
				svg.selectAll("path").attr("d", path);
			})
			.on("end", function() {
				d3.select(this).style("cursor", "grab");
				svg.selectAll("path").style("pointer-events", "auto");
			});

		ocean.call(drag); // Apply drag only to ocean circle
		
		
		// Create tooltip
		const tooltip = d3.select("body").append("div")
			.style("position", "fixed")
			.style("background", "rgba(0,0,0,0.8)")
			.style("color", "white")
			.style("padding", "5px")
			.style("border-radius", "3px")
			.style("overflow", "hidden")

		let pinnedCountry = null; // Track pinned tooltip

		// Helper function to show tooltip
		function showTooltip(d, evt) {
			if(d)
			{
				const site = d.properties.site ? d.properties.site : "https://example.com";
				tooltip.style("visibility", "visible")
					.html(`<iframe src="${site}" width="${window.innerWidth / 2.3}" height="${window.innerHeight / 2.3}" style="border:none;"></iframe>`)
			}
			tooltip.style("left", (evt.clientX + 10) + "px").style("top", (evt.clientY + 10) + "px");
		}
		
		function hideTooltip(){
			tooltip.style("visibility", "hidden")
			pinnedCountry = null;
		}
		hideTooltip();


		// Loading data from json
		d3.json("/colored_world.json", 
			function (data) { 
				// Draw the map 
				svg.append("g") 
					.selectAll("path") 
					.data(data.features) 
					.enter().append("path")
					.style("cursor", "pointer")
					.attr("fill", d => {
					  const c = d.properties.color;
					  return `var(--country-${['one','two','three','four'][c-1]})`;
					})
					.attr("d", d3.geoPath() 
						.projection(projection) 
					)
					.on("click", function(d) {
						if (pinnedCountry === d) {
							// Clicking same country - unpin
							hideTooltip();
						} else {
							// Pin new country
							pinnedCountry = d;
							showTooltip(d, d3.event);
						}
					})
					.on("mouseover", function(d) {
						if (!pinnedCountry) {
							showTooltip(d, d3.event);
						}
					})
					.on("mouseout", function() {
						if (!pinnedCountry) {
							hideTooltip();
						}
					})
					.on("mousemove", function() {
						if (!pinnedCountry) {
						showTooltip(null, d3.event);
						}
					}) 
		})
		
		// Zoom behavior for scroll wheel zooming
		const initialScale = projection.scale();
		const zoom = d3.zoom()
			.scaleExtent([initialScale * 0.5, initialScale * 4])
			.on("zoom", function () {
				const newScale = d3.event.transform.k;
				projection.scale(newScale);
				ocean.attr("r", newScale);
				svg.selectAll("path").attr("d", path);
				hideTooltip();
			});

		svg.call(zoom).call(zoom.transform, d3.zoomIdentity.scale(initialScale));

		
		function updateScale() {
			const newSize = Math.min(window.innerHeight * 0.9, window.innerWidth * 0.9);
			
			// Update SVG dimensions
			svg.attr("width", newSize)
			   .attr("height", newSize);
			
			// Update projection with new scale and translate
			projection.scale(newSize * 0.5)
					  .translate([newSize / 2, newSize / 2]);
			
			// Redraw all paths with updated projection
			svg.selectAll("path").attr("d", path);
			
			// Update any other elements that depend on size (circles, etc.)
			svg.selectAll("circle")
			   .attr("cx", newSize / 2)
			   .attr("cy", newSize / 2)
			   .attr("r", newSize * 0.5);
		}

		// Add resize event listener
		window.addEventListener('resize', updateScale);
		
		
			document
	  .getElementById("theme-switcher-grid")
	  .addEventListener("click", function () {
		this.classList.toggle("night-theme");
		if(this.classList.contains("night-theme"))
		{
			document.body.style.backgroundColor = "var(--bg-color-dark)";
			ocean.attr("fill", "var(--ocean-color-dark)");
		}
		else
		{
			document.body.style.backgroundColor = "var(--bg-color-light)";
			ocean.attr("fill", "var(--ocean-color-light)");
		}
	  });
	  
		document.addEventListener("click", function (event) {
		  const isInsideSVG = svg.node().contains(event.target);
		  if (!isInsideSVG) {
			hideTooltip();
		  }
		});

    </script> 
</body>
  
</html>